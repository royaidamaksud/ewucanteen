-- 1. Create Staff table
CREATE TABLE staff (
  staff_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  role TEXT,
  phone TEXT
);

-- 2. Create Students table
CREATE TABLE students (
  student_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  department TEXT,
  phone TEXT
);

-- 3. Create Menu Items table
CREATE TABLE menu_items (
  item_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  price DECIMAL(10,2) NOT NULL,
  available BOOLEAN DEFAULT TRUE
);

-- 4. Create Stock table
CREATE TABLE stock (
  stock_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  item_id BIGINT REFERENCES menu_items(item_id),
  quantity INTEGER,
  last_updated TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now())
);

-- 5. Create Orders table
CREATE TABLE orders (
  order_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  student_id BIGINT REFERENCES students(student_id),
  staff_id BIGINT REFERENCES staff(staff_id),
  order_date TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()),
  status TEXT DEFAULT 'Pending', -- Pending, Completed, Cancelled
  total DECIMAL(10,2)
);

-- 6. Create Order Details table
CREATE TABLE order_details (
  detail_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  order_id BIGINT REFERENCES orders(order_id),
  item_id BIGINT REFERENCES menu_items(item_id),
  quantity INTEGER NOT NULL,
  price DECIMAL(10,2) NOT NULL
);

-- 7. Create Payments table
CREATE TABLE payments (
  payment_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  order_id BIGINT REFERENCES orders(order_id),
  payment_method TEXT,
  amount DECIMAL(10,2),
  payment_date TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now())
);

-- =========================
-- SAMPLE DATA INSERTION
-- =========================

-- Staff
INSERT INTO staff (name, role, phone) VALUES
('Rahim', 'Manager', '01711111111'),
('Karim', 'Cashier', '01822222222');

-- Students
-- NOTE: The app currently defaults to student_id = 1 for orders, so we need at least one student.
INSERT INTO students (name, department, phone) VALUES
('Sajid Ikbal', 'CSE', '01933333333'),
('Arafat', 'EEE', '01644444444');

-- Menu
INSERT INTO menu_items (name, price, available) VALUES
('Burger', 120.00, TRUE),
('Sandwich', 80.00, TRUE),
('Tea', 20.00, TRUE),
('Chicken Fry', 90.00, TRUE),
('Singara', 10.00, TRUE),
('Coffee', 30.00, TRUE);

-- Stock
INSERT INTO stock (item_id, quantity) VALUES
(1, 50),
(2, 40),
(3, 100);

ALTER TABLE menu_items ADD COLUMN image_url TEXT;